<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>img-pwa</title>
    <!-- 加载清单 -->
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./app.css">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js') // 注册sw.js 文件中变成的服务对象，返回注册成功的对象
                .then(function (swReg) {
                    swRegistration = swReg;
                    console.log('已注册成功service worker');
                }).catch(function (error) {
                    console.error('Service Worker Error', error);
                });
        }
    </script>
</head>

<body>
    <div id="app">
        <div class='title'>欢迎试用PWA网页</div>
        <button id='btn'>添加到桌面</button>
        <div class='img'>
            <img src='./img/pic1.jpg'>
            <img src='./img/pic1-1.jpg'>
            <img src='./img/pic2.jpg'>
            <img src='./img/pic2-1.jpg'>
            <img src='./img/pic3.jpg'>
            <img src='./img/pic3-1.jpg'>
        </div>
    </div>
</body>
<script>
    document.onready = function () {

        // 取消添加到主屏幕
        window.addEventListener('beforeinstallprompt', function (e) {
            e.preventDefault();
            return false;
        });

        // 添加到主屏幕后响应
        window.addEventListener('beforeinstallprompt', function (event) {
            event.userChoice.then(result => {
                console.log(result);
                // {outcome: "dismissed", platform: ""} // 取消添加
                // {outcome: "accepted", platform: "web"} // 完成添加
            });
        });

        // 手动添加，要等到符合规格后才能起效
        let savedPrompt = null; // 用来保存 事件
        const btn = document.getElementById('btn');
        // 添加到主屏幕后响应
        window.addEventListener('beforeinstallprompt', function (e) {
            e.preventDefault();
            savedPrompt = e;
            return false;
        });
        btn.addEventListener('click', function () {
            if (savedPrompt) {
                console.log(savedPrompt);
                // 异步触发横幅显示，弹出选择框，代替浏览器默认动作
                savedPrompt.prompt();
                // 接收选择结果
                savedPrompt.userChoice.then(result => {
                    console.log(result);
                });
            }
        });
    }
</script>

</html>